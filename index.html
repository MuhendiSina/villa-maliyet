<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Villa Maliyet Hesaplama</title>
  <style>
    body {{ font-family: Arial; padding: 30px; }}
    table {{ border-collapse: collapse; width: 100%; margin-top: 20px; }}
    th, td {{ border: 1px solid #ccc; padding: 8px; text-align: right; }}
    th {{ background-color: #f0f0f0; text-align: left; }}
    .toggle {{ cursor: pointer; color: #1e70bf; }}
    .hidden {{ display: none; }}
    .alt {{ color: #666; text-align: left; padding-left: 24px; font-style: italic; }}
  </style>
</head>
<body>
  <h2>Villa Maliyet Hesaplama (GitHub JSON Canlı)</h2>
  <label>Toplam İnşaat Alanı (m²): </label>
  <input type="number" id="area" value="286" onchange="calculate()" />

  <table id="costTable">
    <thead>
      <tr><th>İmalat Kalemi</th><th>Birim Fiyat (TL/m²)</th><th>Toplam Tutar (TL)</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let maliyetVerisi = {{}};

    function toggle(group) {{
      document.querySelectorAll("." + group).forEach(row => {{
        row.classList.toggle("hidden");
      }});
    }}

    function calculate() {{
      const area = parseFloat(document.getElementById("area").value);
      const tbody = document.querySelector("#costTable tbody");
      tbody.innerHTML = "";
      let total = 0;

      for (const [kalem, [birim, altlar]] of Object.entries(maliyetVerisi)) {{
        const uid = kalem.replace(/\s+/g, '_');
        const toplam = (birim * area).toFixed(2);
        total += parseFloat(toplam);

        tbody.insertAdjacentHTML("beforeend",
          `<tr class="toggle" onclick="toggle('${{uid}}')">
            <td><strong>▶ ${{kalem}}</strong></td>
            <td>${{birim.toFixed(2)}}</td>
            <td>${{toplam}}</td>
          </tr>`);

        for (const [alt, alt_birim] of Object.entries(altlar)) {{
          const alt_toplam = (alt_birim * area).toFixed(2);
          tbody.insertAdjacentHTML("beforeend",
            `<tr class="${{uid}} hidden">
              <td class="alt">- ${{alt}}</td>
              <td>${{alt_birim.toFixed(2)}}</td>
              <td>${{alt_toplam}}</td>
            </tr>`);
        }}
      }}

      tbody.insertAdjacentHTML("beforeend",
        `<tr><th colspan="2">GENEL TOPLAM</th><th>${{total.toLocaleString()}} TL</th></tr>`);
    }}

    fetch("https://raw.githubusercontent.com/MuhendiSina/villa-maliyet/refs/heads/main/maliyetler.json")
      .then(res => res.json())
      .then(data => {{
        maliyetVerisi = data;
        calculate();
      }});
  </script>
</body>
</html>
